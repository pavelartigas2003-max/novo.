<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ù–û–í–û-–û–ë–¨–Ø–í–õ–ï–ù–ò–Ø</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: #f2f2f7;
}
h3 {
  margin-bottom: 10px;
}
.search {
  padding: 12px;
  width: 100%;
  margin-bottom: 15px;
  border-radius: 12px;
  border: 1px solid #ddd;
}
.categories {
  display: flex;
  overflow-x: auto;
  margin-bottom: 15px;
}
.cat {
  padding: 8px 16px;
  background: #fff;
  border-radius: 20px;
  margin-right: 10px;
  flex-shrink: 0;
  cursor: pointer;
  transition: transform 0.2s;
}
.cat:hover {
  transform: scale(1.05);
}
.list {
  display: flex;
  flex-direction: column;
  gap: 15px;
}
.item {
  background: #fff;
  border-radius: 15px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.2s, box-shadow 0.2s;
}
.item:hover {
  transform: translateY(-3px);
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}
.item img {
  width: 100%;
  height: 180px;
  object-fit: cover;
}
.item-content {
  padding: 12px;
}
.item-title {
  font-weight: bold;
  font-size: 16px;
  margin-bottom: 6px;
}
.item-price {
  color: #FF6B00;
  font-size: 15px;
  margin-bottom: 10px;
}
.item-actions {
  display: flex;
  gap: 10px;
}
.item-actions button {
  flex: 1;
  padding: 10px;
  border: none;
  border-radius: 10px;
  color: #fff;
  font-weight: bold;
  cursor: pointer;
  transition: opacity 0.2s;
}
.item-actions button:hover {
  opacity: 0.9;
}
.call-btn { background: #28a745; }
.msg-btn { background: #007bff; }
</style>
</head>
<body>

<h3>–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
<div class="categories" id="cats"></div>

<input class="search" id="q" placeholder="–ü–æ–∏—Å–∫...">

<div class="list" id="list"></div>

<h3>–î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</h3>
<input id="title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" class="search">
<input id="price" placeholder="–¶–µ–Ω–∞" class="search">
<textarea id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ" class="search"></textarea>
<input type="file" id="img">

<button onclick="add()">üí¨ –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>

<script>
const tg = Telegram.WebApp;
tg.expand();
const api = "http://localhost:3000/api"; // –∑–∞–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π –±–µ–∫–µ–Ω–¥

const categories = ["–¢–µ—Ö–Ω–∏–∫–∞","–û–¥–µ–∂–¥–∞","–£—Å–ª—É–≥–∏","–ê–≤—Ç–æ","–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å","–î—Ä—É–≥–æ–µ"];

document.getElementById("cats").innerHTML = categories
  .map(c => `<div class="cat" onclick="load('${c}')">${c}</div>`).join("");

async function load(cat="") {
  const q = document.getElementById("q").value;
  const res = await fetch(`${api}/posts?cat=${cat}&q=${q}`);
  const data = await res.json();

  document.getElementById("list").innerHTML = data.map(p => `
    <div class="item">
      <img src="${p.img}" onclick="openPost('${p.id}')">
      <div class="item-content">
        <div class="item-title">${p.title}</div>
        <div class="item-price">${p.price} ‚ÇΩ</div>
        <div class="item-actions">
          <button class="call-btn" onclick="callUser(event, '${p.user}')">üìû –ü–æ–∑–≤–æ–Ω–∏—Ç—å</button>
          <button class="msg-btn" onclick="msgUser(event, '${p.user}')">‚úâÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å</button>
        </div>
      </div>
    </div>
  `).join("");
}

function openPost(id){
  window.location.href = `post.html?id=${id}`;
}

function callUser(e, userId){
  e.stopPropagation();
  alert('–ü–æ–∑–≤–æ–Ω–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: ' + userId);
}

function msgUser(e, userId){
  e.stopPropagation();
  alert('–ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é: ' + userId);
}

async function add(){
  const fd = new FormData();
  fd.append("title", title.value);
  fd.append("price", price.value);
  fd.append("desc", desc.value);
  fd.append("cat", "–î—Ä—É–≥–æ–µ");
  fd.append("user", tg.initDataUnsafe.user.id);
  fd.append("img", document.getElementById("img").files[0]);

  await fetch(api+"/posts", {method:"POST", body:fd});
  load();
}

document.getElementById("q").oninput = () => load();
load();
</script>

</body>
</html>

